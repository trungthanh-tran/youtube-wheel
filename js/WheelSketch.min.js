function WheelSketch(_p5){const radius=203,endpoint="https://airdropbackend.spincoin.xyz",diameter=406,itemsPerScreen=10,campaignTextSize=45,height_str=40.6,counterInitial=0,centerX=10,hasNonprintableChars=string=>/[^\x00-\x7F\u0410-\u044FЁё]/.test(string),startAnimationHandler=function(startAnimation){startAnimation()};let data=[],messages=[],messageDisplayDuration=2e3,wheelTextSize=20,lastKeyPressTime=0,useStaticList=!0,data_list=[],prize_collection=[],awarded_collection=[],theme_images=[],static_list=[],counter,counterDelta=0,counterMax,circleTop,theme,circleCenterY,animationsMap=new Map,selectedKey,isCounterAnimation=!1,counterPrevTickValue=0,clockWise=!0,scaleFactor,fontRegular,mouseDragEnable=!0,loadedData=!1;function getTotalRowsForDurationAndSpeed(videoDurationSec=22,speedItemsPerSec=3){return 10*videoDurationSec}function splitText(text,maxWidth,size){let words=text.split(" "),lines=[],currentLine="";_p5.textSize(size);for(let word of words){let testLine=""===currentLine?word:currentLine+" "+word,testLineWidth;_p5.textWidth(testLine)<=maxWidth?currentLine=testLine:(lines.push(currentLine),currentLine=word)}return lines.push(currentLine),lines}function vect(current,from,to,overflow=!0){const offset=-3,overallDegrees=_p5.map(current+-3,from+-3,to,-90,90,!overflow),v=p5.Vector.fromAngle(_p5.radians(overallDegrees),203);return v}function incrementCounter(delta=1){delta=_p5.deltaTime/100*delta,counterDelta=delta,counter+=delta,_p5.onMoveWheel(delta)}function data_key(data_len,key){return data_len?key>=0&&key<data_len?key:data_key(data_len,key>0?Math.abs(data_len-key):data_len+key):key}function alignToRow(endCallback){const half=20.3,rest=counter%40.6;let newValue=counter-rest;rest>20.3&&(newValue=counter+40.6-rest),animate(tickCounter,counter,newValue,1e3,(function(){animCounterStop(),endCallback&&endCallback()}),easeOutBack)}function tickCounter(v){isCounterAnimation=!0,counterPrevTickValue||(counterPrevTickValue=counter),counterDelta=v-counterPrevTickValue,counter+=counterDelta,counterPrevTickValue=v}function animCounterStop(){isCounterAnimation=!1,counterDelta=0,counterPrevTickValue=0}function animate(tickHook,startNum,endNum,durationMs,callback,easingEq){easingEq=easingEq||easeOutExpo;const changeInNum=endNum-startNum,startTime=Date.now(),engine=function(){const now=Date.now(),timeSpent=now-startTime,timeNorm=timeSpent/durationMs,completionNorm=easingEq(timeNorm),newNum=startNum+completionNorm*changeInNum;timeSpent>durationMs?(animationsMap.delete(`${startNum},${endNum},${durationMs}`),callback&&callback()):tickHook(newNum)};animationsMap.set(`${startNum},${endNum},${durationMs}`,engine)}function truncateHexNumber(hexNumber){const parts=hexNumber.split("x"),truncatedRest=parts[1].slice(0,2)+"..."+parts[1].slice(-6);return"0x"+truncatedRest}function getTickPrize(number_of_round,number_of_prize,number_of_period=30){let tick=[],number_prize_per_round=Math.floor(number_of_prize/number_of_round),remaining=number_of_prize-number_prize_per_round*number_of_round;for(let number=0;number<number_of_round;number++)if(remaining>0){let current=getRandomNonDuplicateElements(number_of_period,number_prize_per_round+1);tick.push(current),remaining-=1}else{let current=getRandomNonDuplicateElements(number_of_period,number_prize_per_round);tick.push(current)}return tick}function getRandomNonDuplicateElements(range,count){if(count>range)throw new Error("Count should not exceed the range.");const result=[],availableElements=Array.from({length:range},(_,i)=>i+1);for(let i=0;i<count;i++){const randomIndex=Math.floor(Math.random()*availableElements.length);result.push(availableElements[randomIndex]),availableElements.splice(randomIndex,1)}return result}touchYPrev=0,useDefaultFont=!1,currentRound=0,question_X=0,currentQuestion="",campaignTitle="",campaign_X=0,linesDescription=[],_p5.setData=function(_data_list,index=0){if(data_list=_data_list,useStaticList)data=static_list;else{let _data=_data_list[index].data;_data.length||(_data=[""]),data=_data.map(v=>"object"==typeof v?v:{title:v,display_title:v})}useDefaultFont=hasNonprintableChars(data.map(v=>v.title).join()),counterMax=40.6*data.length,counter=0,_p5.triggerSelectItem()},_p5.setVideo=function(videos){video=videos},_p5.onAfterSetup=function(){},_p5.onSelectItem=function(theme_images,selectedKey){},_p5.triggerSelectItem=function(){_p5.onSelectItem(theme_images,selectedKey)},_p5.preload=()=>{fontRegular=_p5.loadFont("./fonts/Oswald-Regular.ttf")},_p5.onStartWheel=durationSec=>{},_p5.onStopWheel=()=>{},_p5.onMoveWheel=delta=>{},_p5.setup=()=>{counterMax=40.6*data.length;const canvas=_p5.createCanvas(800,500);let file;canvas.parent("canvas"),_p5.textSize(20),_p5.textFont(fontRegular),_p5.textLeading(24),_p5.fill(200),circleTop=(_p5.height-406)/2+_p5.textAscent()/3,circleCenterY=circleTop+203,counter=0,button=document.querySelector("#play-btn"),fetch(endpoint+"/api/rounds?populate[events][populate]=*").then(x=>x.text()).then(y=>{let dataLoaded,atrribute=JSON.parse(y).data[0].attributes,dataWheel=atrribute.events;campaignTitle=atrribute.description,_p5.textSize(45),_p5.stroke(0),_p5.strokeWeight(3),linesDescription=splitText(campaignTitle,window.innerWidth-30,45),useStaticList=atrribute.static_list,campaign_X=window.innerWidth-10;let roundData=[],getTheme,drop_users;for(const oneRound of dataWheel){let oneRoundData={},parseID=oneRound.youtube_id.match(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$/);oneRoundData.id=parseID[5],oneRoundData.question="",oneRoundData.data=oneRound.answers,roundData.push(oneRoundData)}prize_collection=getTickPrize(dataWheel.length,atrribute.prize_number),theme=atrribute.theme,fetch(endpoint+"/api/themes?populate=*&filters[name][$eq]="+theme).then(xTheme=>xTheme.text()).then(yTheme=>{let theme=JSON.parse(yTheme);if(theme&&theme.data[0]&&theme.data[0].attributes&&theme.data[0].attributes.list&&theme.data[0].attributes.list.data)for(const themeImage of theme.data[0].attributes.list.data)themeImage.attributes.url&&theme_images.push(endpoint+themeImage.attributes.url);(!theme_images||theme_images.length<1)&&(console.log("Cannot load theme. Use default"),theme_images.push("/images/items/001.png"),theme_images.push("/images/items/002.png"),theme_images.push("/images/items/003.png"),theme_images.push("/images/items/004.png"),theme_images.push("/images/items/005.png"),theme_images.push("/images/items/006.png"),theme_images.push("/images/items/007.png"))}),fetch(endpoint+"/api/drop-lists").then(xTheme=>xTheme.text()).then(yTheme=>{let theme=JSON.parse(yTheme);if(theme&&theme.data[0]&&theme.data[0].attributes&&theme.data[0].attributes.drop_users){let users;const lines=theme.data[0].attributes.drop_users.split("\n");static_list=lines.map(line=>({title:line,display_title:truncateHexNumber(line)}))}_p5.setData(roundData,0),loadYoutubeIframe(_p5),loadedData=!0,currentQuestion=""})}),button.addEventListener("click",(function(event){return loadedData&&(overlay=document.querySelector("#overlay-start"),overlay.style.display="none",_p5.playRound()),!1})),_p5.onAfterSetup()},_p5.onNextRound=function(){var canv=document.getElementById("countdown-canvas");if(canv.style.display="none",currentRound+=1,currentRound<data_list.length){currentQuestion="";var overlay=document.createElement("div");overlay.id="overlay",document.body.appendChild(overlay);var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.id="my-svg",svg.setAttribute("viewBox","-500 -500 1000 1000"),svg.setAttribute("width","100%"),svg.setAttribute("height","100%"),svg.setAttribute("preserveAspectRatio","xMidYMin slice");var svgContent=`\n              <defs>\n                  <filter id="goo">\n                      <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur"></feGaussianBlur>\n                      <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -5" result="goo"></feColorMatrix>\n                      <feComposite in="SourceGraphic" in2="goo" operator="atop"></feComposite>\n                  </filter>\n              </defs>\n              <text x="0" y="-35vh" text-anchor="middle" font-size="40" font-family="Overpass Mono, monospace;" fill="white">Ready for the round ${currentRound+1}</text>\n              <g filter="url(#goo)">\n                  <text x="0" y="5vh">3</text>\n                  <text x="0" y="5vh">2</text>\n                  <text x="0" y="5vh">1</text>\n                  <text x="0" y="5vh">GO</text>\n              </g>\n          `;svg.innerHTML=svgContent,document.body.appendChild(svg),overlay.style.display="flex",static_list=static_list.filter(item=>!awarded_collection.includes(item.title)),setTimeout((function(){overlay.style.display="none",overlay.remove(),svg.remove(),canv.style.opacity="1",_p5.reloadData(currentRound),_p5.playRound()}),4e3)}else{var overlayStart=document.getElementById("overlay-start"),playButton=document.getElementById("play-btn"),leaderboard=document.getElementById("leaderboard");overlayStart.style.display="block",playButton.style.display="none",leaderboard.style.display="block",leaderboard.style.zIndex=99999;const olElement=document.querySelector(".leaderboard ol");let data_push;awarded_collection.forEach((player,index)=>{const liElement=document.createElement("li");let current=truncateHexNumber(player);liElement.innerHTML=`\n          <mark>${current}</mark>\n        `,olElement.appendChild(liElement)});const data={data:{timestamp:(new Date).getTime().toString(),partner:"reward",rewarded:awarded_collection.join("\n")}},apiUrl=endpoint+"/api/results";fetch(apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then(response=>response.json()).then(data=>{console.log("Data pushed to Strapi:",data)}).catch(error=>{console.error("Error pushing data to Strapi:",error)}),currentQuestion=""}},_p5.playRound=()=>{clockWise=Math.random()<.5;const videoContainer=document.getElementById("filter-shadow");if(!isCounterAnimation){const durationSec=30,totalRows=getTotalRowsForDurationAndSpeed(durationSec,Math.floor(2*Math.random())+2);_p5.onStartWheel(durationSec),player&&(player.loadVideoById(data_list[currentRound].id),player.playVideo());const countdownContainer=document.getElementById("countdown-canvas");countdownContainer.style.display="block";for(let i=30;i>=0;i--){const countdownElement=document.createElement("div");countdownElement.className="n",countdownElement.textContent=i,countdownContainer.appendChild(countdownElement)}console.log(prize_collection[currentRound]);for(const award of prize_collection[currentRound])setTimeout(()=>{_p5.guessIt()},1e3*award);array_shuffle(data),_p5.triggerSelectItem(),videoContainer.style.animation=`play-video ${durationSec}s`;const overlaystart=document.querySelector("#overlay-start");overlaystart.style.visibility="hidden",animate(tickCounter,counter,counter+40.6*totalRows,1e3*durationSec,()=>{videoContainer.style.animation=null,animCounterStop(),_p5.onNextRound(),alignToRow(()=>{_p5.onStopWheel()})},easeInOutSine)}},_p5.reloadData=function(index){if(useStaticList)data=static_list;else{let _data=data_list[index].data;_data.length||(_data=[""]),data=_data.map(v=>"object"==typeof v?v:{title:v})}useDefaultFont=hasNonprintableChars(data.map(v=>v.title).join()),counterMax=40.6*data.length,counter=0,_p5.triggerSelectItem()},_p5.mouseDragEnable=(state=!0)=>{mouseDragEnable=state},_p5.guessIt=()=>{let currentTime=(new Date).getTime();if(currentTime-lastKeyPressTime>=100){let guess=selectedKey,item=data[selectedKey].title;for(;-1!==awarded_collection.indexOf(item);)guess<data.length-2?guess+=1:guess=0,item=data[guess].title;awarded_collection.push(data[guess].title);let message={key:"Winner "+awarded_collection.length+" : "+data[guess].display_title,timestamp:currentTime,y:Math.random()*_p5.height/2+50};messages.push(message),lastKeyPressTime=currentTime}},_p5.mouseDragged=event=>{if(_p5.mouseX>_p5.width||_p5.mouseX<0||_p5.mouseY>_p5.height||_p5.mouseY<0)return;if(isCounterAnimation)return;if(!mouseDragEnable)return;let delta=4*_p5.movedY;if(void 0===_p5.movedY){let diff=_p5.touches[0].y-touchYPrev;delta=12*(diff<0?-1:0===diff?0:1),touchYPrev=_p5.touches[0].y}return incrementCounter(delta),!1},_p5.draw=()=>{if(_p5.clear(),!loadedData)return;if(useDefaultFont?(_p5.textFont("Georgia"),_p5.textAlign(_p5.LEFT,_p5.BOTTOM)):_p5.textFont(fontRegular),campaignTitle){_p5.textSize(45),_p5.stroke(0,0,0),_p5.strokeWeight(1),_p5.fill(130,130,130);for(let i=0;i<linesDescription.length;i++)campaign_X<800?_p5.text(linesDescription[i],(campaign_X-_p5.textWidth(linesDescription[i]))/2,45+45*i):_p5.text(linesDescription[i],10,45+45*i);_p5.textSize(20),_p5.noFill(),_p5.noStroke()}let currentTime=(new Date).getTime(),key,i;for(let i=0;i<messages.length;i++){let message=messages[i],elapsedTime=currentTime-message.timestamp,opacity=_p5.map(elapsedTime,0,2e3,255,0),y=_p5.map(elapsedTime,0,2e3,message.y,message.y+200);_p5.fill(0,255,0,opacity),_p5.textSize(50),_p5.text(message.key,50,y),_p5.textSize(20),elapsedTime>=2e3&&(messages.splice(i,1),i--)}for(animationsMap.forEach(startAnimationHandler),counterDelta>0?counter<counterMax?isCounterAnimation||incrementCounter(3):counter=0:counter<0&&(counter=counterMax),i=-data.length-2;i<11;i++){let{x:x,y:y}=vect(counter+40.6*i+203,circleTop,circleTop+406,!1);clockWise||(y*=-1),x<10||(_p5.push(),_p5.translate(10,circleCenterY),scaleFactor=_p5.map(x,10,213,1,1.5,!1),x*=2-scaleFactor,y*=2-scaleFactor,_p5.scale(scaleFactor),_p5.fill(255,Math.round(_p5.map(x+10,10,213,0,255,!0))),key=data_key(data.length,i),y<_p5.textAscent()/2&&y>-_p5.textAscent()&&(_p5.fill(212,160,0),key!==selectedKey&&(selectedKey=key,_p5.onSelectItem(theme_images,selectedKey))),_p5.text(data[key].display_title,x+30,y,450),_p5.pop())}}}